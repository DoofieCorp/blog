<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Combining smart switches and smart lights | Rants of a software engineer</title>

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/hyde.css">
  <link rel="stylesheet" href="/css/poole-overrides.css">
  <link rel="stylesheet" href="/css/hyde-overrides.css">
  <link rel="stylesheet" href="/css/hyde-x.css">
  <link rel="stylesheet" href="/css/highlight/sunburst.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/touch-icon-144-precomposed.png">
  <link href="/favicon.png" rel="icon">

  
  
  
  

  <meta name="description" content="Overview of my smart lighting system, preferred products and how to configure them for the best user experience">
  <meta name="keywords" content="Smart Home,Tasmota,Smart Lights,Home Assistant">
  
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-33060296-1', 'auto');
    ga('send', 'pageview');
  </script>
  
</head>
<body>
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      
      <h1>Ian Duffy</h1>
      <p class="lead">Rants of a software engineer</p>
    </div>

    <ul class="sidebar-nav">
      
    </ul>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item">
      <a href="http://github.com/imduffy15"><i class="fa fa-github-square fa-3x"></i></a>
      
      
      <a href="https://ie.linkedin.com/in/imduffy15"><i class="fa fa-linkedin-square fa-3x"></i></a>
      
      
      
      <a href="https://www.youtube.com/channel/UCoGs2iiOIGrfXofp-3g-Qqg"><i class="fa fa-youtube-square fa-3x"></i></a>
      
      </li>
    </ul>

    
  </div>
</div>


<div class="content container">
  <div class="post">
    <h1 class="post-title">Combining smart switches and smart lights</h1>
    <p>Lighting is core to any smart home system. The systems attempt to make it as accessible as possible; there shouldn&rsquo;t be a need to search for a light switch when entering a walkway a motion sensor should take care of it, there shouldn&rsquo;t be a need to have to get out of bed to switch out the light before going to sleep, there shouldn&rsquo;t be a need to run around every room before leaving the house to ensure lights are off and there shouldn&rsquo;t be a need to manually turn on and off your outdoor lights every night.</p>
<p>While there are many lighting products on the smart home market their implementation of them leaves a lot to be desired. In general, I believe the user experience of them is poor, this post will hopefully show you that there is a better way to have all the benefits of smart lighting without the poor user experience features of tape across light switches or warning signs saying to not turn them off. An important goal for me when introducing any smart home technology into my home is that the dumb functionality works in parallel to the smart functionality and in the event of failure of the smart functionality.</p>
<center>
<p><img src="/images/combining-smart-sitches-and-bulbs/light-switch-taped.png" alt="Light switch with tape over it"></p>
</center>
<h2 id="requirements-for-my-smart-lighting-setup">Requirements for my smart lighting setup</h2>
<ul>
<li>A physical light switch should still work to toggle a light on/off</li>
<li>The system should be WiFi based, I already have lots of access points</li>
<li>There should be no dependency on internet connectivity</li>
<li>Support for smart bulbs and fancy LED light fittings should exist</li>
<li>Both the bulbs and light switches should be based on ESP chips to allow flashing with an opensource firmware</li>
</ul>
<h2 id="products">Products</h2>
<p>A smart light switch can be used on its own. However, a smart bulb needs to be combined with a smart light switch for a good user experience.</p>
<p>My general approach to product selection is anything that runs <a href="/images/combining-smart-sitches-and-bulbs/https://tasmota.github.io/docs/">Tasmota</a>, <a href="https://templates.blakadder.com/">https://templates.blakadder.com/</a> provides a fantastic catalogue of these products.</p>
<p>For my setup I ended up with:</p>
<h3 id="switches">Switches:</h3>
<ul>
<li><a href="/images/combining-smart-sitches-and-bulbs/https://templates.blakadder.com/minitiger_1gang-V2.html">Minitiger switch</a></li>
</ul>
<h3 id="bulbs">Bulbs:</h3>
<ul>
<li><a href="/images/combining-smart-sitches-and-bulbs/https://templates.blakadder.com/novostella_UT55505.html">Novostella 5W bulb</a></li>
<li><a href="/images/combining-smart-sitches-and-bulbs/https://templates.blakadder.com/novostella_UT55507.html">Novostella 7W</a></li>
<li><a href="/images/combining-smart-sitches-and-bulbs/https://templates.blakadder.com/athom_LB01-15W-E27.html">Athom 15W</a></li>
<li><a href="/images/combining-smart-sitches-and-bulbs/https://templates.blakadder.com/athom_LB017W.htm">Athom 7W</a></li>
</ul>
<p>I do not recommend the switches I got or any touch-capacitive light switches, the feedback on them is poor and they are overly sensitive. At the time of purchasing, there weren&rsquo;t any physical buttons/switches available, thankfully this has now changed.</p>
<p>The Novostella light bulbs are no longer flashable with Tasmota so they are no longer worth purchasing. The Athom bulbs come pre-flashed with Tasmota and are my preferred choice.</p>
<p>I have since purchased other switches/bulbs to test out, while they work well I&rsquo;m in no position to replace everything at present:</p>
<h3 id="switches-1">Switches</h3>
<ul>
<li><a href="/images/combining-smart-sitches-and-bulbs/https://templates.blakadder.com/sonoff_SwitchMan_M5-3C.html">Sonoff M5</a></li>
<li><a href="/images/combining-smart-sitches-and-bulbs/https://templates.blakadder.com/athom_SW01-TAS-3EU.html">Athom Switch</a></li>
<li><a href="/images/combining-smart-sitches-and-bulbs/https://shop.shelly.cloud/index.php?route=product/search&amp;search=switch">Shelly Switches/Relays</a></li>
</ul>
<p>The Sonoff switches are the most aesthetically pleasing in my opinion, they require manual flashing to Tasmota but the process is straightforward.</p>
<p>The Athom switch comes preflashed with Tasmota and likely provides the most friendly installation experience.</p>
<p>The Shelly relays are <a href="/images/combining-smart-sitches-and-bulbs/https://github.com/yaourdt/mgos-to-tasmota">OTA flashable</a>, however, they require a deep back box and could make for a tight fit.</p>
<h3 id="bulbs-1">Bulbs</h3>
<ul>
<li><a href="/images/combining-smart-sitches-and-bulbs/https://templates.blakadder.com/athom_LB01-15W-E27.html">Athom B22 15W</a></li>
<li><a href="/images/combining-smart-sitches-and-bulbs/https://templates.blakadder.com/athom_LB017W.html">Athom B22/E27 7W</a></li>
<li><a href="/images/combining-smart-sitches-and-bulbs/https://templates.blakadder.com/athom_LB10-5W-TAS.html">Athom GU10 5W</a></li>
<li><a href="/images/combining-smart-sitches-and-bulbs/https://templates.blakadder.com/shelly_DUO.html">Shelly Duo</a></li>
<li><a href="/images/combining-smart-sitches-and-bulbs/https://templates.blakadder.com/shelly_DUO_RGBW_GU10.html">Shelly GU10</a></li>
<li><a href="/images/combining-smart-sitches-and-bulbs/https://templates.blakadder.com/shelly_DUO_RGBW.html">Shelly Duo RGBW</a></li>
</ul>
<p>The Athom bulbs come preflashed with Tasmota. They are available with both an E27 and B22 connector on the <a href="/images/combining-smart-sitches-and-bulbs/https://www.aliexpress.com/item/4001281509550.html">Athom store</a>.</p>
<p>The Shelly bulbs are <a href="/images/combining-smart-sitches-and-bulbs/https://github.com/yaourdt/mgos-to-tasmota">OTA flashable</a>. However, as they are not available in a B22 socket form they aren&rsquo;t of much use for ceiling lights.</p>
<h3 id="product-selection-in-hindsight">Product selection in hindsight</h3>
<p>In the event I was to purchase all my smart home lighting equipment again it would be a mix of the <a href="/images/combining-smart-sitches-and-bulbs/https://sonoff.tech/product/smart-wall-swtich/m5/">Sonoff M5 switches</a> and the <a href="https://www.aliexpress.com/item/4001281509550.html">Athom bulbs</a>.</p>
<h2 id="switch-configuration">Switch configuration</h2>
<center>
<p><img src="/images/combining-smart-sitches-and-bulbs/tasmota-3-gang-switch.png" alt="Tasmota with a 3 gang switch"></p>
</center>
<p>To get the light switch and bulb to work well together it&rsquo;s best to maintain a constant live feed to the bulb. This can be done in Tasmota by disconnecting the buttons and status LEDs from the relays and pointing them at other Tasmota devices via the Tasmota <a href="/images/combining-smart-sitches-and-bulbs/https://tasmota.github.io/docs/Device-Groups/">device groups feature</a>.</p>
<p>Forcing a constant live feed to the bulb can be achieved by modifying Tasmota&rsquo;s template:</p>
<center>
<p><img src="/images/combining-smart-sitches-and-bulbs/switch-gpio.png" alt="Athom 3 gang switch gpio configuration"></p>
</center>
<p>Taking Relay 1 on GPIO13 for example, we can see it has a LED on GPIO16 and a Button on GPIO12 mapped to it, as a result pressing the Button connected to GPIO12 will toggle Relay 1 and LED 1.</p>
<p>There is a bunch of different methods to disconnect the buttons from the relays but my preferred method is as follows:</p>
<ul>
<li>Change the <code>LED</code> to <code>Relay_i</code> and assign it a relay number of <code>original + amount of real relays</code>, so for example on a 3 gang switch LED 1 would be <code>1 + 3 = 4</code>, LED 2 would be <code>2 + 3 = 5</code>, LED 3 would be <code>3 + 3 = 6</code></li>
<li>Change the buttons so that they map to the newly created Relays on the LEDs, That is button1 becomes button4, button2 becomes button5 and button3 becomes button6</li>
</ul>
<p>With this change made, the template page looks like the following:</p>
<center>
<p><img src="/images/combining-smart-sitches-and-bulbs/tasmota-template-disconnected-relays.png" alt="Tasmota template with disconnected relays"></p>
</center>
<p>Pressing the physical buttons on the light switch now just results in the status LED toggling, additionally, more buttons have appeared on the Tasmota web interface:</p>
<center>
<p><img src="/images/combining-smart-sitches-and-bulbs/tasmota-virtual-realys-ui.png" alt="Tasmota UI with real relays and LEDs as relays"></p>
</center>
<h3 id="device-syncing">Device syncing</h3>
<p>Finally, the device groups can be configured to sync on/off status with other devices.</p>
<p>From the switch, navigate to the console page and execute the following:</p>
<ul>
<li>Enable the device group feature <a href="/images/combining-smart-sitches-and-bulbs/https://tasmota.github.io/docs/Commands/#setoption85"><code>SetOption85 1</code></a></li>
<li>Name all the device groups <code>devgroupname1 ceiling_light</code> <code>devgroupname2 lamp</code></li>
<li>Associate each of the relays to a unique device group <a href="/images/combining-smart-sitches-and-bulbs/https://tasmota.github.io/docs/Commands/#setoption88"><code>SetOption88 1</code></a></li>
<li>Tie the different device groups to your different buttons. <code>devgrouptie1 4</code> would sync LED4/Button4 with devgroup ceiling_light</li>
</ul>
<p>From the device you wish to control, navigate to its console page and execute the following:</p>
<ul>
<li>Enable the device group feature <a href="/images/combining-smart-sitches-and-bulbs/https://tasmota.github.io/docs/Commands/#setoption85"><code>SetOption85 1</code></a></li>
<li>Name all the device groups <code>devgroupname1 ceiling_light</code></li>
</ul>
<p>Pressing what was originally <code>Button1</code> should now toggle <code>ceiling_light</code>. At this point, you should have control of your bulb via your voice assistant, the tasmota web interface, <a href="/images/combining-smart-sitches-and-bulbs/https://www.home-assistant.io/">home assistant</a> or a similar 3rd party smart home system, and lastly, the light switch where pressing the light switch doesn&rsquo;t cut the power and impair the other toggling methods. This leaves you in a good position to start extending your lighting setup with automations.</p>

  </div>
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>

