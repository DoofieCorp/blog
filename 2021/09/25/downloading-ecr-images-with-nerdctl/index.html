<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Downloading ECR images with nerdctl | Rants of a software engineer</title>

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/hyde.css">
  <link rel="stylesheet" href="/css/poole-overrides.css">
  <link rel="stylesheet" href="/css/hyde-overrides.css">
  <link rel="stylesheet" href="/css/hyde-x.css">
  <link rel="stylesheet" href="/css/highlight/sunburst.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/touch-icon-144-precomposed.png">
  <link href="/favicon.png" rel="icon">

  
  
  
  

  <meta name="description" content="Tutorial on how to use nerdctl to download private images from ECR">
  <meta name="keywords" content="docker,ecr,nerdctl,images">
  
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-33060296-1', 'auto');
    ga('send', 'pageview');
  </script>
  
</head>
<body>
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      
      <h1>Ian Duffy</h1>
      <p class="lead">Rants of a software engineer</p>
    </div>

    <ul class="sidebar-nav">
      
    </ul>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item">
      <a href="http://github.com/imduffy15"><i class="fa fa-github-square fa-3x"></i></a>
      
      
      <a href="https://ie.linkedin.com/in/imduffy15"><i class="fa fa-linkedin-square fa-3x"></i></a>
      
      
      
      <a href="https://www.youtube.com/channel/UCoGs2iiOIGrfXofp-3g-Qqg"><i class="fa fa-youtube-square fa-3x"></i></a>
      
      </li>
    </ul>

    
  </div>
</div>


<div class="content container">
  <div class="post">
    <h1 class="post-title">Downloading ECR images with nerdctl</h1>
    <p>With Docker Desktop changing their licencing many folks are in need of a replacement. <a href="https://github.com/containerd/nerdctl">Nerdctl</a> is worthy of this, combined with <a href="https://github.com/lima-vm/lima">Lima</a> it provides a Docker like CLI interface.</p>
<p>While the CLI interface mostly remains the same, a question that might arise is &ldquo;How to I pull/push images from private repositories?&rdquo;</p>
<p>Lima provides a linux virtual environment for nerdctl to run in. By introducing a <code>$HOME/.docker/config.json</code> authentication can occur as normal.</p>
<p>By default, Lima will mount your home folder to <code>/Users/username</code> while maintaining its own home folder at <code>/home/username.linux</code>, for ease of configuration a be symbolic linked can be created  between the two:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">osx $ lima
lima $ ln -s /Users/username/.docker <span class="nv">$HOME</span>/.docker
lima $ ln -s /Users/username/.aws <span class="nv">$HOME</span>/.aws
</code></pre></div><p>Doing this will make both your docker and AWS configurations available to nerdctl.</p>
<p>Assuming your docker configuration already contains a <code>credHelpers</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;credHelpers&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;AWS_ACCOUNT_ID.dkr.ecr.REGION.amazonaws.com&#34;</span><span class="p">:</span> <span class="s2">&#34;ecr-login&#34;</span><span class="p">,</span>
    <span class="nt">&#34;public.ecr.aws&#34;</span><span class="p">:</span> <span class="s2">&#34;ecr-login&#34;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>All thats left is to download <a href="https://github.com/awslabs/amazon-ecr-credential-helper">Amazon ECR Docker Credential Helper</a> to somewhere on your $PATH within lima:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">lima $ sudo wget -O /usr/bin/docker-credential-ecr-login https://amazon-ecr-credential-helper-releases.s3.us-east-2.amazonaws.com/0.5.0/linux-amd64/docker-credential-ecr-login 
lima $ sudo chmod <span class="m">755</span> /usr/bin/docker-credential-ecr-login
</code></pre></div><p>You can now <code>nerdctl image pull &lt;private-ecr-image&gt;</code>.</p>

  </div>
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>

